{"version":3,"sources":["webpack://platformer-game/./app/areas/index.js","webpack://platformer-game/./app/controller/audio.js","webpack://platformer-game/./app/controller/index.js","webpack://platformer-game/./app/controller/input.js","webpack://platformer-game/./app/controller/mouse-input.js","webpack://platformer-game/./app/engine/index.js","webpack://platformer-game/./app/game/animator.js","webpack://platformer-game/./app/game/coin.js","webpack://platformer-game/./app/game/coins.js","webpack://platformer-game/./app/game/collider.js","webpack://platformer-game/./app/game/index.js","webpack://platformer-game/./app/game/object.js","webpack://platformer-game/./app/game/player.js","webpack://platformer-game/./app/game/portal.js","webpack://platformer-game/./app/game/water.js","webpack://platformer-game/./app/game/world.js","webpack://platformer-game/./app/index.js","webpack://platformer-game/./app/screen/index.js","webpack://platformer-game/./app/screen/tileset.js","webpack://platformer-game/./app/util/index.js","webpack://platformer-game/webpack/bootstrap","webpack://platformer-game/webpack/runtime/define property getters","webpack://platformer-game/webpack/runtime/hasOwnProperty shorthand","webpack://platformer-game/webpack/runtime/make namespace object","webpack://platformer-game/webpack/startup"],"names":["AudioController","this","audios","key","ext","audio","Audio","volume","play","loop","pause","currentTime","value","Controller","up","left","right","type","keyCode","down","getInput","Input","active","MouseInput","id","action","actions","holdit","document","getElementById","btn","start","speedup","timeout","clear","clearTimeout","repeat","setTimeout","onpointerdown","onpointerup","onmouseup","GameEngine","timeStep","update","render","started","updated","time","extraTime","animationFrameRequest","engineLoop","t","timeStamp","window","requestAnimationFrame","performance","now","cancelAnimationFrame","Animator","frameSet","delay","count","frameIndex","frameValue","last","length","Coin","x","y","offsetX","offsetY","super","baseX","baseY","positionX","Math","random","PI","positionY","animator","cos","sin","animate","items","objects","tileSize","collectedCoins","frameSets","forEach","index","image","Image","src","k","push","addImage","top","includes","updateAnimation","Collider","object","tileX","tileY","router","direction","collidePlatformTop","collidePlatformBottom","collidePlatformLeft","collidePlatformRight","flag","keys","split","bottomTile","getTop","getOldTop","setTop","velocityY","leftTile","getRight","getOldRight","setRight","velocityX","rightTile","getLeft","getOldLeft","setLeft","topTile","getBottom","getOldBottom","setBottom","jumping","Game","gameOverCallback","world","over","onGameOver","val","Object","width","height","xOld","yOld","Player","color","imageLeft","imageRight","keyLeft","toLowerCase","keyRight","dead","changeFrameSet","gravity","friction","Portal","destinationX","destinationY","destinationArea","Water","waterObjects","WaterObject","World","rows","columns","coins","totalCoins","player","collider","audioController","data","theme","stopThemeMusic","playThemeMusic","map","areaMap","isPlayerDead","undefined","objectsMap","collisonMap","deathAreas","death","portals","p","water","portal","setCenterX","setCenterY","stop","bottom","_normalizeIndex","floor","collide","maxIndex","object1","object2","collideObject","coin","checkCollision","splice","indexOf","prefetch","addEventListener","areaId","startBtn","startTitle","startScreen","toggleStartScreen","style","visibility","controller","game","textContent","setupWorld","setup","screen","setupScreen","querySelector","buffer","canvas","resize","documentElement","clientWidth","clientHeight","engine","moveLeft","moveRight","jump","hold","resume","drawBackground","drawMap","drawMapObjects","drawObject","waterItem","xOffset","drawPlayer","drawText","keyDownUp","leftMouse","e","rightMouse","upMouse","onclick","reset","Screen","createElement","getContext","context","tileSet","images","i","row","j","drawImage","fillRect","objectImages","element","yOffset","tileBackground","text","font","fillText","rect","ratio","webkitImageSmoothingEnabled","mozImageSmoothingEnabled","imageSmoothingEnabled","TileSet","worldKey","meta","1","objectLen","tileLen","2","3","4","5","uid","Date","toString","substring","body","getElementsByTagName","append","href","item","rel","appendChild","tiles","file","__webpack_module_cache__","__webpack_require__","moduleId","exports","module","__webpack_modules__","d","definition","o","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag"],"mappings":"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","file":"bundle.js","sourcesContent":["import area1 from \"./area-1.json\";\nimport area2 from \"./area-2.json\";\nimport area3 from \"./area-3.json\";\nimport area4 from \"./area-4.json\";\nimport area5 from \"./area-5.json\";\nimport area6 from \"./area-6.json\";\n\nexport default {\n  [area1.id]: area1,\n  [area2.id]: area2,\n  [area3.id]: area3,\n  [area3.id]: area3,\n  [area4.id]: area4,\n  [area5.id]: area5,\n  [area6.id]: area6,\n};\n","export default class AudioController {\n  constructor() {\n    this.audios = {};\n  }\n\n  static play(key, ext = \"wav\") {\n    const audio = new Audio(`./assets/audio/${key}.${ext}`);\n    audio.volume = 0.5;\n    audio.play();\n  }\n\n  play(key, ext = \"wav\") {\n    if (!this.audios[key]) {\n      this.audios[key] = new Audio(`./assets/audio/${key}.${ext}`);\n    }\n\n    this.audios[key].volume = 0.5;\n    this.audios[key].play();\n\n    return this;\n  }\n\n  loop(key) {\n    if (this.audios[key]) {\n      this.audios[key].loop = true;\n    }\n  }\n\n  pause(key) {\n    if (this.audios[key]) {\n      this.audios[key].pause();\n    }\n  }\n\n  stop(key) {\n    if (this.audios[key]) {\n      this.pause(key);\n      this.audios[key].currentTime = 0;\n    }\n  }\n\n  volume(key, value) {\n    if (this.audios[key]) {\n      this.audios[key].volume = value / 100;\n    }\n  }\n}\n","import Input from \"./input\";\n\nexport default class Controller {\n  constructor() {\n    this.up = new Input();\n    this.left = new Input();\n    this.right = new Input();\n  }\n\n  keyDownUp(type, keyCode) {\n    let down = type == \"keydown\" ? true : false;\n\n    switch (keyCode) {\n      case 37:\n      case 65:\n        this.left.getInput(down);\n        break;\n      case 38:\n      case 32:\n        this.up.getInput(down);\n        break;\n      case 39:\n      case 68:\n        this.right.getInput(down);\n    }\n  }\n}\n","export default class Input {\n  constructor() {\n    this.down = false;\n    this.active = false;\n  }\n\n  getInput(down) {\n    if (this.down != down) this.active = down;\n    this.down = down;\n  }\n}\n","export default class MouseInput {\n  constructor(id, action) {\n    this.actions = this.holdit(document.getElementById(id), action, 1000, 2);\n  }\n\n  holdit(btn, action, start, speedup) {\n    let timeout;\n\n    const clear = () => {\n      clearTimeout(timeout);\n    };\n\n    const repeat = function () {\n      action(\"keydown\");\n\n      timeout = setTimeout(repeat, start);\n      start = start / speedup;\n    };\n\n    btn.onpointerdown = function () {\n      repeat();\n    };\n\n    btn.onpointerup = function () {\n      action(\"keyup\");\n\n      clear();\n    };\n\n    btn.onmouseup = function () {\n      action(\"keyup\");\n\n      clear();\n    };\n\n    return { clear };\n  }\n}\n","export default class GameEngine {\n  constructor(timeStep, update, render) {\n    this.timeStep = timeStep;\n    this.update = update;\n    this.render = render;\n    this.started = false;\n\n    this.pause = false;\n\n    this.updated = false;\n\n    this.time = null;\n    this.extraTime = 0;\n    this.animationFrameRequest = null;\n    this.engineLoop = (t) => this.loop(t);\n  }\n\n  loop(timeStamp) {\n    if (this.pause) {\n      return;\n    }\n\n    this.animationFrameRequest = window.requestAnimationFrame(this.engineLoop);\n\n    this.extraTime += timeStamp - this.time;\n    this.time = timeStamp;\n\n    if (this.extraTime >= this.timeStep * 3) {\n      this.extraTime = this.timeStep;\n    }\n\n    while (this.extraTime >= this.timeStep) {\n      this.extraTime -= this.timeStep;\n\n      this.update(this.timeStamp);\n\n      this.updated = true;\n    }\n\n    if (this.updated) {\n      this.updated = false;\n      this.render(this.timeStamp);\n    }\n  }\n\n  start() {\n    this.started = true;\n    this.extraTime = this.timeStep;\n\n    this.time = window.performance.now();\n    this.animationFrameRequest = window.requestAnimationFrame(this.engineLoop);\n  }\n\n  stop() {\n    window.cancelAnimationFrame(this.animationFrameRequest);\n  }\n\n  hold() {\n    this.pause = true;\n  }\n\n  resume() {\n    this.pause = false;\n  }\n}\n","export default class Animator {\n  constructor(frameSet, delay = 4) {\n    this.count = 0;\n    this.delay = delay >= 1 ? delay : 1;\n    this.frameSet = frameSet;\n    this.frameIndex = 0;\n    this.frameValue = frameSet[0];\n  }\n\n  animate(last) {\n    this.loop(last);\n  }\n\n  changeFrameSet(frameSet, delay = 4, frameIndex = 0) {\n    if (this.frameSet === frameSet) {\n      return;\n    }\n\n    this.count = 0;\n    this.delay = delay;\n    this.frameSet = frameSet;\n    this.frameIndex = frameIndex;\n    this.frameValue = frameSet[frameIndex];\n  }\n\n  loop(last) {\n    this.count++;\n\n    while (this.count > this.delay) {\n      this.count -= this.delay;\n\n      if (last && this.frameIndex === this.frameSet.length - 1) {\n        this.frameIndex = this.frameSet.length - 1;\n      } else {\n        this.frameIndex =\n          this.frameIndex < this.frameSet.length - 1 ? this.frameIndex + 1 : 0;\n      }\n\n      this.frameValue = this.frameSet[this.frameIndex];\n    }\n  }\n}\n","import Object from \"./object\";\nimport Animator from \"./animator\";\n\nimport { uid } from \"../util\";\n\nexport default class Coin extends Object {\n  constructor(id, x, y, offsetX = 0, offsetY = 0, frameSet) {\n    super(x, y, 8, 10);\n\n    this.id = id;\n    this.offsetX = offsetX;\n    this.offsetY = offsetY;\n\n    this.baseX = x;\n    this.baseY = y;\n    this.positionX = Math.random() * Math.PI * 2;\n    this.positionY = this.positionX * 2;\n\n    this.animator = new Animator(frameSet);\n  }\n\n  update() {\n    this.positionX += 0.1;\n    this.positionY += 0.2;\n\n    this.x = this.baseX + Math.cos(this.positionX) * 2;\n    this.y = this.baseY + Math.sin(this.positionY);\n  }\n\n  updateAnimation() {\n    this.animator.animate();\n  }\n}\n","// import Object from \"./object\";\nimport Coin from \"./coin\";\n\nexport default class items {\n  constructor(objects = [], tileSize, collectedCoins) {\n    this.items = [];\n\n    const keys = [{ id: \"\", count: 16 }];\n\n    this.frameSets = {};\n\n    keys.forEach(({ id, count }) => {\n      for (let index = 1; index <= count; index++) {\n        const image = new Image();\n        image.src = `./assets/sprites/coin/image ${index}.png`;\n\n        const addImage = (k, image) => {\n          if (!this.frameSets[k]) {\n            this.frameSets[k] = [];\n          }\n          this.frameSets[k].push(image);\n        };\n\n        addImage(\"coin\", image);\n      }\n    });\n\n    for (let index = 0; index < objects.length; index++) {\n      const { id, left, top, offsetX, offsetY } = objects[index];\n\n      if (!collectedCoins.includes(id)) {\n        this.items.push(\n          new Coin(id, left * tileSize, top * tileSize, offsetX, offsetY, this.frameSets[\"coin\"])\n        );\n      }\n    }\n  }\n\n  update() {\n    for (let index = 0; index < this.items.length; index++) {\n      this.items[index].update();\n    }\n  }\n\n  updateAnimation() {\n    for (let index = 0; index < this.items.length; index++) {\n      this.items[index].updateAnimation();\n    }\n  }\n}\n","export default class Collider {\n  collide(value, object, tileX, tileY, tileSize) {\n    const router = (direction) => {\n      switch (direction) {\n        case \"t\":\n          return this.collidePlatformTop(object, tileY);\n        case \"b\":\n          return this.collidePlatformBottom(object, tileY + tileSize);\n        case \"l\":\n          return this.collidePlatformLeft(object, tileX);\n        case \"r\":\n          return this.collidePlatformRight(object, tileX + tileSize);\n        default:\n          break;\n      }\n    };\n\n    let flag = false;\n    if (typeof value === \"string\") {\n      const keys = value.split(\"\");\n\n      for (let index = 0; index < keys.length; index++) {\n        flag = router(keys[index]);\n        if (flag) {\n          break;\n        }\n      }\n    }\n\n    return flag;\n  }\n\n  collidePlatformBottom(object, bottomTile) {\n    if (object.getTop() < bottomTile && object.getOldTop() >= bottomTile) {\n      object.setTop(bottomTile);\n      object.velocityY = 0;\n      return true;\n    }\n    return false;\n  }\n\n  collidePlatformLeft(object, leftTile) {\n    if (object.getRight() > leftTile && object.getOldRight() <= leftTile) {\n      object.setRight(leftTile - 0.01);\n      object.velocityX = 0;\n      return true;\n    }\n    return false;\n  }\n\n  collidePlatformRight(object, rightTile) {\n    if (object.getLeft() < rightTile && object.getOldLeft() >= rightTile) {\n      object.setLeft(rightTile);\n      object.velocityX = 0;\n      return true;\n    }\n    return false;\n  }\n\n  collidePlatformTop(object, topTile) {\n    if (object.getBottom() > topTile && object.getOldBottom() <= topTile) {\n      object.setBottom(topTile - 0.01);\n      object.velocityY = 0;\n      object.jumping = false;\n      return true;\n    }\n    return false;\n  }\n}\n","import World from \"./world\";\n\nexport default class Game {\n  constructor(gameOverCallback) {\n    this.world = new World();\n    this.over = false;\n\n    this.onGameOver = () => {\n      this.over = true;\n      gameOverCallback();\n    };\n  }\n\n  update() {\n    this.world.update(this.onGameOver);\n  }\n\n  setGameOver(val) {\n    this.over = val;\n  }\n}\n","export default class Object {\n  constructor(x, y, width, height) {\n    this.height = height;\n    this.width = width;\n    this.x = x;\n    this.xOld = x;\n    this.y = y;\n    this.yOld = y;\n  }\n\n  getBottom() {\n    return this.y + this.height;\n  }\n\n  getLeft() {\n    return this.x;\n  }\n\n  getRight() {\n    return this.x + this.width;\n  }\n\n  getTop() {\n    return this.y;\n  }\n\n  getOldBottom() {\n    return this.yOld + this.height;\n  }\n\n  getOldLeft() {\n    return this.xOld;\n  }\n\n  getOldRight() {\n    return this.xOld + this.width;\n  }\n\n  getOldTop() {\n    return this.yOld;\n  }\n\n  getCenterX() {\n    return this.x + this.width * 0.5;\n  }\n\n  getCenterY() {\n    return this.y + this.height * 0.5;\n  }\n\n  setBottom(y) {\n    this.y = y - this.height;\n  }\n\n  setLeft(x) {\n    this.x = x;\n  }\n\n  setRight(x) {\n    this.x = x - this.width;\n  }\n\n  setTop(y) {\n    this.y = y;\n  }\n\n  setOldBottom(y) {\n    this.yOld = y - this.height;\n  }\n\n  setOldLeft(x) {\n    this.xOld = x;\n  }\n\n  setOldRight(x) {\n    this.xOld = x - this.width;\n  }\n\n  setOldTop(y) {\n    this.yOld = y;\n  }\n\n  setCenterX(x) {\n    this.x = x - this.width * 0.5;\n  }\n\n  setCenterY(y) {\n    this.y = y - this.height * 0.5;\n  }\n}\n","import Object from \"./object\";\nimport Animator from \"./animator\";\nexport default class Player extends Object {\n  constructor() {\n    super(40, 100, 12, 12);\n    this.color = \"#ff0000\";\n\n    this.jumping = true;\n    this.velocityX = 0;\n    this.velocityY = 0;\n    this.direction = 1;\n\n    const keys = [\n      { id: \"Run\", count: 8 },\n      { id: \"Jump\", count: 8 },\n      { id: \"Dead\", count: 8 },\n      { id: \"Idle\", count: 10 },\n    ];\n\n    this.frameSets = {};\n\n    keys.forEach(({ id, count }) => {\n      for (let index = 1; index <= count; index++) {\n        const imageLeft = new Image();\n        const imageRight = new Image();\n        imageLeft.src = `./assets/sprites/player/left/${id} (${index}).png`;\n        imageRight.src = `./assets/sprites/player/right/${id} (${index}).png`;\n\n        const keyLeft = `${id.toLowerCase()}Left`;\n        const keyRight = `${id.toLowerCase()}Right`;\n\n        const addImage = (k, image) => {\n          if (!this.frameSets[k]) {\n            this.frameSets[k] = [];\n          }\n          this.frameSets[k].push(image);\n        };\n\n        addImage(keyLeft, imageLeft);\n        addImage(keyRight, imageRight);\n      }\n    });\n\n    this.animator = new Animator(this.frameSets[\"idleRight\"]);\n  }\n\n  reset() {\n    this.x = 40;\n    this.y = 100;\n    this.xOld = 40;\n    this.yOld = 100;\n    this.jumping = true;\n    this.velocityX = 0;\n    this.velocityY = 0;\n    this.direction = 1;\n  }\n\n  jump() {\n    if (!this.jumping) {\n      this.jumping = true;\n      this.velocityY -= 18;\n    }\n  }\n\n  moveLeft() {\n    this.direction = -1;\n    this.velocityX -= 0.5;\n  }\n  moveRight() {\n    this.direction = 1;\n    this.velocityX += 0.5;\n  }\n\n  updateAnimation({ dead = false }) {\n    if (dead) {\n      if (this.direction < 0) this.animator.changeFrameSet(this.frameSets[\"deadLeft\"], 2);\n      else this.animator.changeFrameSet(this.frameSets[\"deadRight\"], 2);\n\n      this.animator.animate(dead);\n      return;\n    }\n\n    if (this.velocityY < 0) {\n      if (this.direction < 0) this.animator.changeFrameSet(this.frameSets[\"jumpLeft\"], 2);\n      else this.animator.changeFrameSet(this.frameSets[\"jumpRight\"], 2);\n    } else if (this.direction < 0) {\n      if (this.velocityX < -0.1) this.animator.changeFrameSet(this.frameSets[\"runLeft\"]);\n      else this.animator.changeFrameSet(this.frameSets[\"idleLeft\"]);\n    } else if (this.direction > 0) {\n      if (this.velocityX > 0.1) this.animator.changeFrameSet(this.frameSets[\"runRight\"]);\n      else this.animator.changeFrameSet(this.frameSets[\"idleRight\"]);\n    }\n\n    this.animator.animate();\n  }\n\n  update(gravity, friction) {\n    this.xOld = this.x;\n    this.yOld = this.y;\n    this.velocityY += gravity;\n    this.x += this.velocityX;\n    this.y += this.velocityY;\n\n    this.velocityX *= friction;\n    this.velocityY *= friction;\n  }\n}\n","import Object from \"./object\";\n\nexport default class Portal extends Object {\n  constructor({\n    x,\n    y,\n    width,\n    height,\n    direction,\n    destinationX,\n    destinationY,\n    destinationArea,\n  }) {\n    super(x, y, width, height);\n\n    this.direction = direction;\n    this.destinationX = destinationX;\n    this.destinationY = destinationY;\n    this.destinationArea = destinationArea;\n  }\n}\n","import Object from \"./object\";\nimport Animator from \"./animator\";\n\nexport default class Water {\n  constructor(waterObjects = [], tileSize) {\n    this.items = [];\n\n    const keys = [{ id: \"\", count: 17 }];\n\n    this.frameSets = {};\n\n    keys.forEach(({ count }) => {\n      for (let index = 1; index <= count; index++) {\n        const image = new Image();\n        image.src = `./assets/sprites/water/image ${index}.png`;\n\n        const addImage = (k, image) => {\n          if (!this.frameSets[k]) {\n            this.frameSets[k] = [];\n          }\n          this.frameSets[k].push(image);\n        };\n\n        addImage(\"water\", image);\n      }\n    });\n\n    for (let index = 0; index < waterObjects.length; index++) {\n      const { left, top } = waterObjects[index];\n\n      this.items.push(\n        new WaterObject(left * tileSize, top * tileSize, this.frameSets[\"water\"], tileSize)\n      );\n    }\n  }\n\n  update() {\n    for (let index = 0; index < this.items.length; index++) {\n      this.items[index].updateAnimation();\n    }\n  }\n}\n\nclass WaterObject extends Object {\n  constructor(x, y, frameSet, tileSize) {\n    super(x, y, tileSize, tileSize);\n\n    this.animator = new Animator(frameSet, 3);\n  }\n\n  updateAnimation() {\n    this.animator.animate();\n  }\n}\n","import Coins from \"./coins\";\nimport Water from \"./water\";\nimport Player from \"./player\";\nimport Object from \"./object\";\nimport Portal from \"./portal\";\nimport Collider from \"./collider\";\nimport AudioController from \"../controller/audio\";\n\nexport default class World {\n  constructor(friction = 0.87, gravity = 2) {\n    this.friction = friction;\n    this.gravity = gravity;\n\n    this.rows = 12;\n    this.columns = 16;\n    this.tileSize = 16;\n\n    this.coins = [];\n    this.totalCoins = 0;\n    this.collectedCoins = \"\";\n    this.height = this.tileSize * this.rows;\n    this.width = this.tileSize * this.columns;\n\n    this.player = new Player();\n    this.collider = new Collider();\n\n    this.audioController = new AudioController();\n  }\n\n  setup(data) {\n    if (this.theme !== data.theme) {\n      if (data.theme) {\n        this.stopThemeMusic();\n\n        this.theme = data.theme;\n        this.playThemeMusic();\n      }\n    }\n\n    this.id = data.id;\n    this.map = data.areaMap;\n    this.isPlayerDead = undefined;\n    this.objects = data.objectsMap;\n    this.collisonMap = data.collisonMap;\n\n    this.deathAreas = data.death.map(({ x, y, height, width }) => new Object(x, y, width, height));\n\n    this.coins = new Coins(data.coins, this.tileSize, this.collectedCoins);\n\n    this.portals = data.portals.map((p) => new Portal(p));\n\n    this.water = new Water(data.water, this.tileSize);\n\n    if (this.portal) {\n      this.player.setCenterX(this.portal.destinationX);\n      this.player.setCenterY(this.portal.destinationY);\n      this.player.direction = this.portal.direction;\n\n      this.portal = null;\n    }\n  }\n\n  playThemeMusic() {\n    this.audioController.play(this.theme, \"mp3\");\n    this.audioController.volume(this.theme, 4);\n    this.audioController.loop(this.theme);\n  }\n\n  stopThemeMusic() {\n    this.audioController.stop(this.theme);\n  }\n\n  collideObject(object) {\n    if (object.getLeft() < 0 - this.player.width / 2) {\n      object.setLeft(-this.player.width / 2);\n      object.velocityX = 0;\n    } else if (object.getRight() > this.width + this.player.width / 2) {\n      object.setRight(this.width + this.player.width / 2);\n      object.velocityX = 0;\n    }\n    if (object.getTop() < 0 - this.player.height * 2.5) {\n      object.setTop(0 - this.player.height * 2.5);\n      object.velocityY = 0;\n    } else if (object.getBottom() - 1 > this.height) {\n      object.setBottom(this.height);\n      object.velocityY = 0;\n      object.jumping = false;\n    }\n\n    let bottom, left, right, top;\n\n    const setTop = () => {\n      top = this._normalizeIndex(Math.floor(object.getTop() / this.tileSize), this.rows);\n    };\n\n    const setBottom = () => {\n      bottom = this._normalizeIndex(Math.floor(object.getBottom() / this.tileSize), this.rows);\n    };\n\n    const setLeft = () => {\n      left = Math.floor(object.getLeft() / this.tileSize);\n    };\n\n    const setRight = () => {\n      right = Math.floor(object.getRight() / this.tileSize);\n    };\n\n    setTop();\n    setLeft();\n    this.collider.collide(\n      this.collisonMap[top][left],\n      object,\n      left * this.tileSize,\n      top * this.tileSize,\n      this.tileSize\n    );\n\n    setTop();\n    setRight();\n    this.collider.collide(\n      this.collisonMap[top][right],\n      object,\n      right * this.tileSize,\n      top * this.tileSize,\n      this.tileSize\n    );\n\n    setBottom();\n    setLeft();\n    this.collider.collide(\n      this.collisonMap[bottom][left],\n      object,\n      left * this.tileSize,\n      bottom * this.tileSize,\n      this.tileSize\n    );\n\n    setBottom();\n    setRight();\n    this.collider.collide(\n      this.collisonMap[bottom][right],\n      object,\n      right * this.tileSize,\n      bottom * this.tileSize,\n      this.tileSize\n    );\n  }\n\n  _normalizeIndex(index, maxIndex) {\n    if (index >= maxIndex - 1) {\n      return maxIndex - 1;\n    } else if (index < 0) {\n      return 0;\n    }\n\n    return index;\n  }\n\n  checkCollision(object1, object2) {\n    if (\n      object1.x < object2.x + object2.width &&\n      object1.x + object1.width > object2.x &&\n      object1.y < object2.y + object2.height &&\n      object1.y + object1.height > object2.y\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  update(onGameOver) {\n    this.player.update(this.gravity, this.friction);\n\n    this.collideObject(this.player);\n\n    for (let index = 0; index < this.coins.items.length; index++) {\n      const coin = this.coins.items[index];\n\n      coin.update();\n      coin.updateAnimation();\n\n      if (this.checkCollision(this.player, coin)) {\n        this.coins.items.splice(this.coins.items.indexOf(coin), 1);\n\n        this.collectedCoins += `${coin.id},`;\n\n        AudioController.play(\"coin\");\n        this.totalCoins += 1;\n      }\n    }\n\n    let dead = false;\n    if (!dead) {\n      for (let index = 0; index < this.deathAreas.length; index++) {\n        if (this.checkCollision(this.player, this.deathAreas[index])) {\n          if (this.isPlayerDead === undefined) {\n            AudioController.play(\"fall\", \"mp3\");\n\n            this.player.velocityX = 0;\n            this.stopThemeMusic();\n            onGameOver();\n          }\n          this.isPlayerDead = true;\n          this.theme = undefined;\n          this.collectedCoins = \"\";\n          this.totalCoins = 0;\n          dead = true;\n          break;\n        }\n      }\n    }\n\n    if (!this.portal) {\n      for (let index = 0; index < this.portals.length; index++) {\n        if (this.checkCollision(this.player, this.portals[index])) {\n          this.portal = this.portals[index];\n          break;\n        }\n      }\n    }\n\n    this.player.updateAnimation({ dead });\n\n    this.water.update();\n  }\n}\n","import Game from \"./game\";\nimport Screen from \"./screen\";\nimport GameEngine from \"./engine\";\nimport Controller from \"./controller\";\nimport MouseInput from \"./controller/mouse-input\";\n\nimport { prefetch } from \"./util\";\n\nprefetch();\n\nimport areas from \"./areas\";\n\nwindow.addEventListener(\"load\", function () {\n  \"use strict\";\n\n  let areaId = 1;\n\n  const startBtn = document.getElementById(\"startBtn\");\n  const startTitle = document.getElementById(\"startTitle\");\n  const startScreen = document.getElementById(\"startScreen\");\n\n  const toggleStartScreen = (value) => {\n    startScreen.style.visibility = !value ? \"hidden\" : \"visible\";\n  };\n\n  const controller = new Controller();\n\n  // GAME\n  const game = new Game(() => {\n    startTitle.textContent = \"Game Over\";\n    setTimeout(() => {\n      toggleStartScreen(true);\n    }, 1000);\n  });\n\n  const setupWorld = () => {\n    game.world.setup(areas[areaId]);\n  };\n\n  // SCREEN\n  let screen;\n\n  const setupScreen = () => {\n    screen = new Screen(document.querySelector(\"canvas\"), areas[areaId].world);\n\n    screen.buffer.canvas.height = game.world.height;\n    screen.buffer.canvas.width = game.world.width;\n  };\n\n  setupScreen();\n\n  // GAME ENGINE\n\n  const update = () => {\n    if (!game.over) {\n      if (controller.left.active) {\n        game.world.player.moveLeft();\n      }\n      if (controller.right.active) {\n        game.world.player.moveRight();\n      }\n      if (controller.up.active) {\n        game.world.player.jump();\n        controller.up.active = false;\n      }\n    }\n\n    if (game.world.portal) {\n      engine.hold();\n\n      areaId = game.world.portal.destinationArea;\n\n      setupWorld();\n      setupScreen();\n\n      engine.resume();\n    }\n\n    game.update();\n  };\n\n  const render = () => {\n    screen.drawBackground();\n    screen.drawMap(game.world.map);\n    screen.drawMapObjects(game.world.objects);\n    // screen.drawArea(game.world.portals);\n    // screen.drawArea(game.world.deathAreas);\n\n    // draw coins\n    if (game.world.coins) {\n      for (let index = 0; index < game.world.coins.items.length; index++) {\n        const coin = game.world.coins.items[index];\n\n        screen.drawObject(\n          coin.animator.frameValue,\n          coin.x,\n          coin.y,\n          coin.width,\n          coin.height,\n          coin.offsetX,\n          coin.offsetY\n        );\n        // screen.drawRect(coin);\n      }\n    }\n\n    // draw water animations\n    if (game.world.water) {\n      for (let index = 0; index < game.world.water.items.length; index++) {\n        const waterItem = game.world.water.items[index];\n\n        screen.drawObject(\n          waterItem.animator.frameValue,\n          waterItem.x,\n          waterItem.y,\n          waterItem.width,\n          waterItem.height,\n          waterItem.offsetX,\n          waterItem.offsetY\n        );\n      }\n    }\n\n    // draw player\n    const xOffset = game.world.player.direction < 0 ? -36 : -12;\n\n    screen.drawPlayer(\n      game.world.player.animator.frameValue,\n      game.world.player.getLeft(),\n      game.world.player.getTop(),\n      60,\n      40,\n      xOffset,\n      -24\n    );\n\n    // draw coin count\n    const image = new Image();\n    image.src = \"./assets/sprites/coin/image 1.png\";\n    screen.drawObject(image, 13.3 * 16, 8, 10, 10);\n    screen.drawText(\"x\", 14.2 * 16, 15);\n    screen.drawText(game.world.totalCoins, 14.7 * 16, 16);\n\n    screen.render();\n  };\n\n  const resize = () => {\n    let width = document.documentElement.clientWidth;\n    let height = document.documentElement.clientHeight;\n\n    if (width < 600) {\n      [width, height] = [height, width];\n    }\n\n    screen.resize(width - 4, height - 4, game.world.height / game.world.width);\n    screen.render();\n  };\n\n  resize();\n\n  var engine = new GameEngine(1000 / 30, update, render);\n\n  // EVENTS HANDLER\n  const keyDownUp = ({ type, keyCode }) => {\n    controller.keyDownUp(type, keyCode);\n  };\n\n  window.addEventListener(\"keydown\", keyDownUp);\n  window.addEventListener(\"keyup\", keyDownUp);\n  window.addEventListener(\"resize\", resize);\n\n  const leftMouse = new MouseInput(\"leftBtn\", (e) => {\n    controller.keyDownUp(e, 37);\n  });\n  const rightMouse = new MouseInput(\"rightBtn\", (e) => {\n    controller.keyDownUp(e, 39);\n  });\n  const upMouse = new MouseInput(\"jumpBtn\", (e) => {\n    controller.keyDownUp(e, 32);\n  });\n\n  const clearMouse = () => {\n    upMouse.actions.clear();\n    leftMouse.actions.clear();\n    rightMouse.actions.clear();\n  };\n\n  startBtn.onclick = () => {\n    clearMouse();\n    startTitle.textContent = \"\";\n    toggleStartScreen(false);\n\n    game.world.player.reset();\n    game.over = false;\n\n    engine.hold();\n\n    areaId = 1;\n\n    setupWorld();\n    setupScreen();\n\n    engine.resume();\n\n    if (!engine.started) {\n      engine.start();\n    }\n  };\n});\n","import TileSet from \"./tileset\";\n\nexport default class Screen {\n  constructor(canvas, world) {\n    this.buffer = document.createElement(\"canvas\").getContext(\"2d\");\n    this.context = canvas.getContext(\"2d\");\n\n    this.tileSet = new TileSet(16, 8, world);\n  }\n\n  drawMap(map) {\n    const { images, tileSize } = this.tileSet;\n\n    for (let i = 0; i < map.length; i++) {\n      const row = map[i];\n      for (let j = 0; j < row.length; j++) {\n        const value = row[j];\n\n        if (value) {\n          const image = images[value];\n\n          let destinationX = j * tileSize;\n          let destinationY = i * tileSize;\n\n          this.buffer.drawImage(image, destinationX, destinationY, tileSize, tileSize);\n        }\n      }\n    }\n  }\n\n  drawArea(object) {\n    for (let index = 0; index < object.length; index++) {\n      const { x, y, width, height } = object[index];\n      this.buffer.fillRect(x, y, width, height);\n    }\n  }\n\n  drawMapObjects(objects) {\n    const { objectImages, tileSize } = this.tileSet;\n\n    for (let i = 0; i < objects.length; i++) {\n      const row = objects[i];\n      for (let j = 0; j < row.length; j++) {\n        const value = row[j];\n\n        if (value) {\n          value.forEach((element) => {\n            const { id, xOffset = 0, yOffset = 0, width = 16, height = 16 } = element;\n            const image = objectImages[id];\n\n            let destinationX = j * tileSize;\n            let destinationY = i * tileSize;\n\n            this.buffer.drawImage(\n              image,\n              destinationX + xOffset,\n              destinationY + yOffset,\n              width,\n              height\n            );\n          });\n        }\n      }\n    }\n  }\n\n  drawBackground() {\n    this.buffer.drawImage(\n      this.tileSet.tileBackground,\n      0,\n      0,\n      this.buffer.canvas.width,\n      this.buffer.canvas.height\n    );\n  }\n\n  drawText(text, x, y) {\n    this.buffer.font = \"10px Arial\";\n    this.buffer.fillText(text, x, y);\n  }\n\n  drawPlayer(image, destinationX, destinationY, width, height, offsetX, offsetY, rect) {\n    this.drawObject(image, destinationX + offsetX, destinationY + offsetY, width, height);\n  }\n\n  drawObject(image, destinationX, destinationY, width, height, offsetX = 0, offsetY = 0) {\n    this.buffer.drawImage(image, destinationX + offsetX, destinationY + offsetY, width, height);\n  }\n\n  drawRect({ x, y, width, height }) {\n    this.buffer.fillRect(x, y, width, height);\n  }\n\n  resize(width, height, ratio) {\n    if (height / width > ratio) {\n      this.context.canvas.height = width * ratio;\n      this.context.canvas.width = width;\n    } else {\n      this.context.canvas.height = height;\n      this.context.canvas.width = height / ratio;\n    }\n\n    this.context.webkitImageSmoothingEnabled = false;\n    this.context.mozImageSmoothingEnabled = false;\n    this.context.imageSmoothingEnabled = false;\n  }\n\n  render() {\n    this.context.drawImage(\n      this.buffer.canvas,\n      0,\n      0,\n      this.buffer.canvas.width,\n      this.buffer.canvas.height,\n      0,\n      0,\n      this.context.canvas.width,\n      this.context.canvas.height\n    );\n  }\n}\n","export default class TileSet {\n  constructor(tileSize, columns, world = 1) {\n    const worldKey = `world-${world}`;\n    this.columns = columns;\n    this.tileSize = tileSize;\n\n    this.images = [];\n    this.images.push(null);\n\n    this.objectImages = [];\n    this.objectImages.push(null);\n\n    this.tileBackground = new Image();\n\n    const meta = {\n      1: { objectLen: 11, tileLen: 18 },\n      2: { objectLen: 10, tileLen: 18 },\n      3: { objectLen: 15, tileLen: 16 },\n      4: { objectLen: 14, tileLen: 16 },\n      5: { objectLen: 12, tileLen: 25 },\n    };\n\n    for (let index = 1; index <= meta[world].objectLen; index++) {\n      const image = new Image();\n\n      image.src = `./assets/sprites/${worldKey}/objects/${index}.png`;\n\n      this.objectImages.push(image);\n    }\n\n    for (let index = 1; index <= meta[world].tileLen; index++) {\n      const image = new Image();\n      image.src = `./assets/sprites/${worldKey}/tiles/${index}.png`;\n\n      this.images.push(image);\n    }\n\n    this.tileBackground.src = `./assets/sprites/${worldKey}/bg.png`;\n  }\n}\n","export const uid = () => {\n  return Date.now().toString(36) + Math.random().toString(36).substring(2);\n};\n\nexport const prefetch = () => {\n  const items = {\n    sprites: [\n      { key: \"world-1\", objects: 11, tiles: 18 },\n      { key: \"world-2\", objects: 10, tiles: 18 },\n      { key: \"world-3\", objects: 15, tiles: 16 },\n      { key: \"world-4\", objects: 14, tiles: 16 },\n      { key: \"world-5\", objects: 12, tiles: 25 },\n    ],\n  };\n\n  const body = document.getElementsByTagName(\"body\")[0];\n\n  const append = (href) => {\n    const item = document.createElement(\"link\");\n    item.rel = \"prefetch\";\n    item.href = href;\n    body.appendChild(item);\n  };\n\n  items.sprites.forEach(({ key, objects, tiles }) => {\n    for (let index = 1; index <= objects; index++) {\n      append(`./assets/sprites/${key}/objects/${index}.png`);\n    }\n    for (let index = 1; index <= tiles; index++) {\n      append(`./assets/sprites/${key}/tiles/${index}.png`);\n    }\n\n    append(`./assets/sprites/${key}/bg.png`);\n  });\n\n  const audioFiles = [\n    { file: \"coin\", ext: \"wav\" },\n    { file: \"desert\" },\n    { file: \"dungeon\" },\n    { file: \"fall\" },\n    { file: \"grasslands\" },\n    { file: \"iceland\" },\n  ];\n\n  audioFiles.forEach(({ file, ext = \"mp3\" }) => {\n    append(`./assets/audio/${file}.${ext}`);\n  });\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// startup\n// Load entry module\n__webpack_require__(\"./app/index.js\");\n// This entry module used 'exports' so it can't be inlined\n"],"sourceRoot":""}